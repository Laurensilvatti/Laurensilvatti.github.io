---
output: 
  html_document:
    toc: yes
    toc_float:
      collapsed: false
pagetitle: MyReportOnMiseBehavior
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(easystats)
library(plotly)
library(kableExtra)
library(janitor)
library(patchwork)
library(readxl)
library(hms) 
library(dplyr)
theme_set(theme_minimal())

```

## My Final Project 

### Data Analysis Course - Utah Valley University - Lauren Guerrero Silva
___

I am currently working with mice to determine whether or not their Pomc mutation has any effect
on their sexual behavior.
Proopiomelanocortin (Pomc) is a polypeptide found primarily in the arcuate nucleus (ARC) of the hypothalamus. 
The Pomc-allele synthesizes several products. The combination of resultant peptides makes Pomc a powerful influence
on overall health, particularly in relation to body size and fertility. A mutation at the nPE1 site of the Pomc 
gene results in a 70% deficiency of Pomc expression. In humans, this translates to extreme hyperphagia, early 
onset (and extreme) obesity, hypercortisolism, light skin, and red hair pigmentation.
Many of these effects are apparent on a mouse model. The goal is to create a mouse model that helps in determining
the cause for the observed infertility experienced by Pomc-deficient individuals, specifically evaluating the differences 
between wild-type (control) mice and affected POMC-deficient (mutant) mice in sexual behavior: libido, 
adherance to copulatory norms, and ultrasonic communication.

Here is a look at the raw data I worked with.

# Raw Data


```{r}
df <- read_excel("../media/trial_edited.xlsx") %>% 
  clean_names()

df %>% 
  kable() %>% 
  kable_classic(lightable_options = 'hover') %>% 
  scroll_box(height = '200px')

```

This data set is of Male and Female mice, and the presence of certain sexual behaviors and their respective duration during a set period of time. Our goal is to see if we can build a model that uses these measures to predict sexual behavior in Pomc deficient mice.

___

# Cleaning

In order to properly analyze this data I have to do a few data tidying tasks first

```{r echo=TRUE}

df$behaviour <- 
  df$behaviour %>% tolower()

clean <-  df %>% 
  separate(col=timestamps,
           into= c("start_time","end_time"),
           sep = "-",      #not necessary to type in this case, but this is how is done.
           convert = TRUE) #converted characters to integers.

clean$start_time <- 
  clean$start_time %>% 
  as_hms()

clean$end_time <- 
  clean$end_time %>% 
  as_hms()

clean$start_time %>% class()

clean <- 
  clean %>% 
  mutate(duration_in_s = (end_time - start_time) %>% 
           as_hms())

#Separating Sex, Mouse Type, Mouse ID
clean$sex <-  clean$mouse_id %>%  
  str_sub(1,1)

clean$mouse_type <- clean$mouse_id %>% 
  str_sub(2,3)

clean$mouse_id_number <- ifelse(clean$mouse_id %>%  nchar == 6,
                             clean$mouse_id %>% str_sub(4,6),
                             clean$mouse_id %>% str_sub(5,7))

# Modifying mouse type to be more readable.
clean <- clean %>% 
  mutate(mouse_type = case_when(mouse_type == "WT" ~ "Wild type",     
                           mouse_type == "HE" ~ "Heterozigot",
                           mouse_type == "HO" ~ "Homozigot")) 

# Reorganize columns in a more readable way.
colnames(clean)
clean <- clean[, c("trial_number", "mouse_id_number", "mouse_type",
             "sex", "date", "start_time", "end_time",
             "duration_in_s", "behaviour",  "frequency")]


```

Female mice do not present behaviors of mounting... for obvious reasons. 

This is how the clean data looks like:

```{r}
clean %>% as.data.frame() %>% 
  kableExtra::kable() %>% 
  kable_classic(lightable_options = 'hover') %>% 
  scroll_box(height = '300px')

```

___


# Visualizing

```{r}

clean %>% 
  filter(duration_in_s < "00:02:00" %>% as.hms()) %>% 
  ggplot(aes(x=behaviour,y=duration_in_s, fill=sex)) +
  geom_boxplot() +
  facet_wrap(~mouse_type,scales = 'free_y') +
  labs(y="Duration",x="Behavior",title = "Durantion of behavior")+
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90,
                                   vjust = .5))

```

