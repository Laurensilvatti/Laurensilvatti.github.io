---
output: 
  html_document:
    toc: yes
    toc_float:
      collapsed: false
pagetitle: MyReportOnMiseBehavior
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(easystats)
library(kableExtra)
library(janitor)
library(readxl)
library(hms) 
library(dplyr)
theme_set(theme_minimal())

```

## My Final Project 

### Data Analysis Course - Utah Valley University - Lauren Guerrero Silva
___

I am currently working with mice to determine whether or not their Pomc mutation has any effect
on their sexual behavior.
Proopiomelanocortin (Pomc) is a polypeptide found primarily in the arcuate nucleus (ARC) of the hypothalamus. 
The Pomc-allele synthesizes several products. The combination of resultant peptides makes Pomc a powerful influence
on overall health, particularly in relation to body size and fertility. A mutation at the nPE1 site of the Pomc 
gene results in a 70% deficiency of Pomc expression. In humans, this translates to extreme hyperphagia, early 
onset (and extreme) obesity, hypercortisolism, light skin, and red hair pigmentation.
Many of these effects are apparent on a mouse model. The goal is to create a mouse model that helps in determining
the cause for the observed infertility experienced by Pomc-deficient individuals, specifically evaluating the differences 
between wild-type (control) mice and affected POMC-deficient (mutant) mice in sexual behavior: libido, 
adherance to copulatory norms, and ultrasonic communication.

Here is a look at the raw data I worked with.

# Raw Data


```{r}
df <- read_excel("../media/trial_edited.xlsx") %>% 
  clean_names()

df %>% 
  kable() %>% 
  kable_classic(lightable_options = 'hover') %>% 
  scroll_box(height = '200px')
```


#
The present data set includes information on male and female mice, comprising their respective genetic make-up (homozygous, heterozygous, or wild-type) and the duration of specific sexual behaviors exhibited over a 30 minute time interval. This research objectives encompass the comprehensive analysis of this data set to ascertain whether significant differences in sexual behavior among mice can be attributed to their genetic makeup.

___

# Cleaning


Prior to commencing a comprehensive analysis of the data, several data tidying tasks need to be performed.

<button class="btn btn-primary" data-toggle="collapse" data-target="#rCode1">Show/Hide R Code 1</button>
<div id="rCode1" class="collapse">
```{r echo=TRUE}
df$behaviour <- 
  df$behaviour %>% tolower()

clean <-  df %>% 
  separate(col=timestamps,
           into= c("start_time","end_time"),
           sep = "-",      #not necessary to type in this case, but this is how is done.
           convert = TRUE) #converted characters to integers.

clean$start_time <- 
  clean$start_time %>% 
  as_hms()

clean$end_time <- 
  clean$end_time %>% 
  as_hms()

clean$start_time %>% class()

clean <- 
  clean %>% 
  mutate(duration_in_s = (end_time - start_time) %>% 
           as_hms())

#Separating Sex, Mouse Type, Mouse ID
clean$sex <-  clean$mouse_id %>%  
  str_sub(1,1)

clean$mouse_type <- clean$mouse_id %>% 
  str_sub(2,3)

clean$mouse_id_number <- ifelse(clean$mouse_id %>%  nchar == 6,
                             clean$mouse_id %>% str_sub(4,6),
                             clean$mouse_id %>% str_sub(5,7))

# Modifying mouse type to be more readable.
clean <- clean %>% 
  mutate(mouse_type = case_when(mouse_type == "WT" ~ "Wild type",     
                           mouse_type == "HE" ~ "Heterozigot",
                           mouse_type == "HO" ~ "Homozigot")) 

# Reorganize columns in a more readable way.
colnames(clean)
clean <- clean[, c("trial_number", "mouse_id_number", "mouse_type",
             "sex", "date", "start_time", "end_time",
             "duration_in_s", "behaviour")]

```
</div>

#
The previous R code is part of the data cleaning process. The *df* dataframe, which contains the original data, is first modified by converting all behavior values to lowercase. Then, the *timestamps* column is separated into *start_time* and *end_time* columns, which are subsequently converted from characters to time objects using the **as_hms()** function. A new *duration_in_s* column is created by calculating the difference in seconds between the *start_time* and *end_time* columns.

Next, the *mouse_id* column is separated into *sex*, *mouse_type*, and *mouse_id_number* columns using the **str_sub()** function. The *mouse_type* values are modified to be more readable, with "WT" representing "Wild type", "HE" representing "Heterozigot", and "HO" representing "Homozigot". Finally, the columns are reordered for better readability.

___ 


# Cleaned Data

The resulting clean dataframe will now be presented in a tabular format using the **kableExtra::kable()** function as done with the original data. This chart shows the *trial number*, *mouse ID number*, *mouse type*, *sex*, *date*, *start time*, *end time*, *duration in seconds*, and *behavior*. The table reveals that female mice did not exhibit mounting behavior, which is expected due to their biological differences from male mice.

```{r}
clean %>% as.data.frame() %>% 
  kableExtra::kable() %>% 
  kable_classic(lightable_options = 'hover') %>% 
  scroll_box(height = '300px')

```

___

# Visualizing the Data

Adding a visual representation of our data frame can be helpful to understand the patterns and relationships within the data more easily. It can also help us identify outliers, trends, and other important features of the data that may not be immediately apparent when looking at the raw numbers.
This plot shows the duration of behaviors exhibited by male and female mice of different genetic types. The behaviors were filtered to include only those with a duration of less than two minutes to exclude a few outliers found in the dataframe.  The plot shows the distribution of duration in seconds for each behavior using box plots, with the behavior on the x-axis and the duration on the y-axis. The plot is further divided into subplots based on the genetic type of the mice, with the y-axis scales varying between the subplots. The plot suggests that there are differences in the duration of certain behaviors between male and female mice of different genetic types.

```{r}
clean %>% 
  filter(between(duration_in_s, as.hms("00:00:00"), as.hms("00:02:00"))) %>% 
  ggplot(aes(x=behaviour,y=duration_in_s, fill=sex)) +
  geom_boxplot() +
  facet_wrap(~mouse_type, scales = 'free_y') +
  labs(y="Duration",x="Behavior",title = "Durantion of behavior")+
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = .5))

```

The preceding graph indicates that wild-type male and female mice exhibited a greater frequency of sexual behaviors, while heterozygous and homozygous mice primarily engaged in anogenital sniffing across multiple trials.

___

# Multidimentional Scaling

In order to fully utilize the information in our data set, it becomes necessary to shift gears from traditional linear models to exploratory data analysis techniques that can handle multiple variables. One such technique is dimension reduction, which allows us to identify the most important variables while also reducing the complexity of our data set. In this context, we will be using the metaMDS (multidimensional scaling) ANOVA analysis, which is a powerful and widely-used method that provides a low-dimensional representation of our high-dimensional data set. This analysis is particularly important for our research because it enables us to identify the most important variables that contribute to the variation in our data and to identify patterns and trends that may not be immediately apparent using traditional linear models. Ultimately, this type of analysis can help us gain a deeper understanding of the complex relationships among the variables in our data set, and can provide important insights for further research and analysis.

To begin this process I will create two different data frames. The first data frame will focus on the duration of each behavior by sex and mouse type, while the second data frame will provide information on the frequency of each behavior. This approach will enable us to identify any underlying patterns or trends in our data and facilitate further statistical analyses.

#
<button class="btn btn-primary" data-toggle="collapse" data-target="#rCode2">Show/Hide R Code 2</button>
<div id="rCode2" class="collapse">
```{r echo=TRUE}
#1. Columns of Mouse type, sex, behavior (each beh get a column) and total time of behavior.
time <- clean %>%
  mutate(start_time = as.POSIXct(paste(date, start_time)),
         end_time = as.POSIXct(paste(date, end_time))) %>%
  group_by(mouse_id_number, mouse_type, sex) %>%
  summarize(anogenital_sniffing = sum(difftime(end_time[behaviour == "anogenital sniffing"], 
                                               start_time[behaviour == "anogenital sniffing"])),
            pelvic_thrusting = sum(difftime(end_time[behaviour == "pelvic thrusting"], 
                                            start_time[behaviour == "pelvic thrusting"])),
            post_intromission_grooming = sum(difftime(end_time[behaviour == "post intromission grooming"], 
                                                      start_time[behaviour == "post intromission grooming"])),
            appeared_successful_ejaculation = sum(difftime(end_time[behaviour == "appeared successful ejaculation"], 
                                                           start_time[behaviour == "appeared successful ejaculation"])),
            mounting_attempt = sum(difftime(end_time[behaviour == "mounting attempts"], 
                                            start_time[behaviour == "mounting attempts"])))

time <- time %>% 
  mutate_at(vars(4:8), ~ as.numeric(gsub(" secs", "", .)))


#2. Columns of Mouse Type, Sex, Behavior (each beh get a column) and Frequency of behavior. 
freq <- clean %>%
  group_by(mouse_id_number, mouse_type, sex) %>%
  summarize(anogenital_sniffing = sum(behaviour == "anogenital sniffing"),
            pelvic_thrusting = sum(behaviour == "pelvic thrusting"),
            post_intromission_grooming = sum(behaviour == "post intromission grooming"),
            appeared_successful_ejaculation = sum(behaviour == "appeared successful ejaculation"),
            mounting_attempt = sum(behaviour == "mounting attempts"))

```
</div>
#

Below are the new data frames, respectively containing the total time and frequency of behaviors based on mouse ID number, mouse type and sex.

**Total duration in Seconds of each Behavior**
```{r}
time %>% as.data.frame() %>% 
  kableExtra::kable() %>% 
  kable_classic(lightable_options = 'hover') %>% 
  scroll_box(height = '300px')
```
#
**Total Frequency of each Behavior**
```{r}
freq %>% as.data.frame() %>% 
  kableExtra::kable() %>% 
  kable_classic(lightable_options = 'hover') %>% 
  scroll_box(height = '300px')

```



